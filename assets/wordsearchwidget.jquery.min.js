/*!
 * The Word Search Game Widget
 *
 * Copyright 2011, Ryan Fernandes (https://code.google.com/u/@VBFTRFJWDxFDXgJ4/)
 * Licensed under The MIT License.
 * see license.txt
 *
 */
!function($,undefined){var currentWord=0,maxWords=0,encontrePalabra=undefined,cuandoEncuentreTodas=undefined;function Arms(){this.arms=null,this.deduceArm=function(i,t){this.returnToNormal();var s=$(i).parent().children().index(i);switch(this.arms=new Array,t){case 0:this.arms=$(i).prevAll();break;case 1:this.arms=$(i).nextAll();break;case 2:var e=this.arms;$(i).parent().prevAll().each(function(){e.push($(this).children().get(s))});break;case 3:var r=this.arms;$(i).parent().nextAll().each(function(){r.push($(this).children().get(s))});break;case 4:var o=this.arms,n=s;$(i).parent().prevAll().each(function(){o.push($(this).children().get(++n))});break;case 5:var a=this.arms,l=s;$(i).parent().prevAll().each(function(){a.push($(this).children().get(--l))});break;case 6:var h=this.arms,c=s;$(i).parent().nextAll().each(function(){h.push($(this).children().get(++c))});break;case 7:var d=this.arms,u=s;$(i).parent().nextAll().each(function(){d.push($(this).children().get(--u))})}for(var f=1;f<this.arms.length;f++)Visualizer.arm(this.arms[f])},this.glowTo=function(i){for(var t=$(this.arms).index(i),s=1;s<this.arms.length;s++)s<=t?Visualizer.glow(this.arms[s]):Visualizer.arm(this.arms[s])},this.returnToNormal=function(){if(this.arms)for(var i=1;i<this.arms.length;i++)Visualizer.restore(this.arms[i])},this.clean=function(){$(this.arms).each(function(){Visualizer.clean(this)})}}function Hotzone(){this.elems=null,this.createZone=function(i){this.elems=new Array;var t=$(i),s=t.parent().children().index(t),e=t.parent().prev().children().get(s),r=t.parent().next().children().get(s);this.elems.push(t.prev()[0],t.next()[0]),this.elems.push(e,r,$(e).next()[0],$(e).prev()[0],$(r).next()[0],$(r).prev()[0]),$(this.elems).each(function(){null!=$(this)&&Visualizer.arm(this)})},this.index=function(i){return $(this.elems).index(i)},this.setChosen=function(i){for(var t=0;t<this.elems.length;t++)Visualizer.arm(this.elems[t]);-1!=i&&Visualizer.glow(this.elems[i])},this.returnToNormal=function(){for(var i=0;i<this.elems.length;i++)Visualizer.restore(this.elems[i])},this.clean=function(){$(this.elems).each(function(){Visualizer.clean(this)})}}function Root(){this.root=null,this.setRoot=function(i){this.root=i,Visualizer.glow(this.root)},this.returnToNormal=function(){Visualizer.restore(this.root)},this.isSameCell=function(i){return $(this.root).is($(i))},this.clean=function(){Visualizer.clean(this.root)}}$.widget("ryanf.wordsearchwidget",$.ui.mouse,{options:{wordlist:null,gridsize:10,onWordFound:undefined,onWordSearchComplete:undefined},_mapEventToCell:function(i){var t=Math.ceil((i.pageX-this._cellX)/this._cellWidth),s=Math.ceil((i.pageY-this._cellY)/this._cellHeight);return $("#rf-tablegrid tr:nth-child("+s+") td:nth-child("+t+")")},_create:function(){this.model=GameWidgetHelper.prepGrid(this.options.gridsize,this.options.wordlist),this.startedAt=new Root,this.hotzone=new Hotzone,this.arms=new Arms,encontrePalabra=this.options.onWordFound,cuandoEncuentreTodas=this.options.onWordSearchComplete,maxWords=this.options.wordlist.split(",").length,GameWidgetHelper.renderGame(this.element[0],this.model),this.options.distance=0,this._mouseInit();var i=$("#rf-tablegrid tr:first td:first");this._cellWidth=i.outerWidth(),this._cellHeight=i.outerHeight(),this._cellX=i.offset().left,this._cellY=i.offset().top},destroy:function(){return this.hotzone.clean(),this.arms.clean(),this.startedAt.clean(),this._mouseDestroy(),this},_mouseStart:function(i){var t=$(i.target).parents("div").attr("id");"rf-searchgamecontainer"==t&&(this.startedAt.setRoot(i.target),this.hotzone.createZone(i.target))},_mouseDrag:function(i){if(i.target=this._mapEventToCell(i),this.startedAt.isSameCell(i.target))return this.arms.returnToNormal(),void this.hotzone.setChosen(-1);if($(i.target).hasClass("rf-armed")||$(i.target).hasClass("rf-glowing")){var t=this.hotzone.index(i.target);-1!=t?(this.hotzone.setChosen(t),this.arms.deduceArm(this.startedAt.root,t)):this.arms.glowTo(i.target)}},_mouseStop:function(i){var t="";$(".rf-glowing, .rf-highlight",this.element[0]).each(function(){var i=$.data(this,"cell");t+=i.value});var s=this.model.wordList.isWordPresent(t);-1!=s&&($(".rf-glowing, .rf-highlight",this.element[0]).each(function(){Visualizer.select(this),$.data(this,"selected","true")}),GameWidgetHelper.signalWordFound(s));try{this.hotzone.returnToNormal(),this.startedAt.returnToNormal(),this.arms.returnToNormal()}catch(i){}}}),$.extend($.ryanf.wordsearchwidget,{version:"0.0.1"});var Visualizer={glow:function(i){$(i).removeClass("rf-armed").removeClass("rf-selected").addClass("rf-glowing")},arm:function(i){$(i).removeClass("rf-glowing").addClass("rf-armed")},restore:function(i){$(i).removeClass("rf-armed").removeClass("rf-glowing"),null!=i&&"true"==$.data(i,"selected")&&$(i).addClass("rf-selected")},select:function(i){$(i).removeClass("rf-armed").removeClass("rf-glowing").animate({opacity:"20"},500,"linear",function(){$(i).removeClass("rf-highlight").addClass("rf-selected").animate({opacity:"show"},500,"linear")})},highlight:function(i){$(i).removeClass("rf-armed").removeClass("rf-selected").addClass("rf-highlight")},signalWordFound:function(i){$(i).addClass("rf-foundword").animate({opacity:"show"},1e3,"linear")},clean:function(i){$(i).removeClass("rf-armed").removeClass("rf-glowing").removeClass("rf-selected"),$.removeData($(i),"selected")}};function Cell(){this.DEFAULT="-",this.isHighlighted=!1,this.value=this.DEFAULT,this.parentGrid=null,this.isUnwritten=function(){return this.value==this.DEFAULT},this.isSelected=!1,this.isSelecting=!0,this.td=null}function Grid(){this.cells=null,this.directions=["Horizontal","Vertical"],this.initializeGrid=function(i){this.cells=new Array(i);for(var t=0;t<i;t++){this.cells[t]=new Array(i);for(var s=0;s<i;s++){var e=new Cell;e.parentgrid=this,this.cells[t][s]=e}}},this.getCell=function(i,t){return this.cells[i][t]},this.createHotZone=function(i){var t=i;new Array,t.parent().children().index(t)},this.size=function(){return this.cells.length},this.put=function(row,col,word){var populator=eval("new "+eval("this.directions["+Math.floor(Math.random()*this.directions.length)+"]")+"Populator(row,col,word, this)"),isPlaced=populator.populate();if(!isPlaced)for(var x=0;x<this.directions.length;x++){var populator2=eval("new "+eval("this.directions["+x+"]")+"Populator(row,col,word, this)"),isPlaced2=populator2.populate();if(isPlaced2)break}},this.fillGrid=function(){for(var i=0;i<this.size();i++)for(var t=0;t<this.size();t++)this.cells[i][t].isUnwritten()&&(this.cells[i][t].value=String.fromCharCode(Math.floor("А".charCodeAt()+31*Math.random())))}}function HorizontalPopulator(i,t,s,e){this.grid=e,this.row=i,this.col=t,this.word=s,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else for(var i=0;i<this.size;i++){var t=(this.row+i)%this.size,e=this.findContigousSpace(t,s);if(-1==e){var r=this.isWordOverlapPossible(t,s);if(-1==r)continue;this.row=t,this.col=r,this.writeWord();break}this.row=t,this.col=e,this.writeWord();break}return s.isPlaced},this.writeWord=function(){for(var i=s.chars,t=0;t<s.size;t++){var e=new Cell;e.value=i[t],this.cells[this.row][this.col+t]=e,s.containedIn(e),s.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var e=!1,r=0,o=this.word.chars,n=t;n<this.size&&(this.cells[i][n].isUnwritten()||this.cells[i][n]==o[n]);n++)if(++r==s.size){e=!0;break}return e},this.findContigousSpace=function(i,t){for(var s=-1,e=0,r=t.chars,o=0;o<this.size;o++)if(this.cells[i][o].isUnwritten()||this.cells[i][o]==r[o]){if(++e==t.size){s=o-(t.size-1);break}}else e=0;return s}}function VerticalPopulator(i,t,s,e){this.grid=e,this.row=i,this.col=t,this.word=s,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else for(var i=0;i<this.size;i++){var t=(this.col+i)%this.size,e=this.findContigousSpace(t,s);if(-1==e){var r=this.isWordOverlapPossible(t,s);if(-1==r)continue;this.row=r,this.col=t,this.writeWord();break}this.row=e,this.col=t,this.writeWord();break}return s.isPlaced},this.writeWord=function(){for(var i=s.chars,t=0;t<s.size;t++){var e=new Cell;e.value=i[t],this.cells[this.row+t][this.col]=e,s.containedIn(e),s.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var e=!1,r=0,o=this.word.chars,n=i;n<this.size&&(this.cells[n][t].isUnwritten()||o[n]==this.cells[n][t].value);n++)if(++r==s.size){e=!0;break}return e},this.findContigousSpace=function(i,t){for(var s=-1,e=0,r=t.chars,o=0;o<this.size;o++)if(this.cells[o][i].isUnwritten()||r[o]==this.cells[o][i].value){if(++e==t.size){s=o-(t.size-1);break}}else e=0;return s}}function LeftDiagonalPopulator(i,t,s,e){this.grid=e,this.row=i,this.col=t,this.word=s,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else{var i=this.findContigousSpace(this.row,this.col,s);if(1!=i[0])i:for(var t=this.size-s.size;t>=0;t--)for(var e=0;e<2;e++){var r=this.findContigousSpace(0==e?t:0,0==e?0:t,s);if(1==r[0]){this.row=r[1],this.col=r[2],this.writeWord();break i}}else this.row=i[1],this.col=i[2],this.writeWord()}return s.isPlaced},this.writeWord=function(){for(var i=s.chars,t=this.row,e=this.col,r=0;r<s.size;r++){var o=new Cell;o.value=i[r],this.cells[t++][e++]=o,s.containedIn(o),s.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var i=!1,t=0,e=this.word.chars,r=this.row,o=this.col,n=0;o<this.grid.size()&&r<this.grid.size()&&(this.cells[r][o].isUnwritten()||this.cells[r][o]==e[n++]);){if(++t==s.size){i=!0;break}r++,o++}return i},this.findContigousSpace=function(i,t,s){for(var e=!1,r=0,o=s.chars,n=i,a=t;n>0&&a>0;)n--,a--;for(var l=0;;){if(this.cells[n][a].isUnwritten()||this.cells[n][a]==o[l++]){if(++r==s.size){e=!0;break}}else r=0;if(n++,++a>=this.size||n>=this.size)break}return e&&(n=n-s.size+1,a=a-s.size+1),[e,n,a]}}function RightDiagonalPopulator(i,t,s,e){this.grid=e,this.row=i,this.col=t,this.word=s,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else{var i=this.findContigousSpace(this.row,this.col,s);if(1!=i[0])i:for(var t=this.size-1,e=this.size-s.size;e>=0;e--)for(var r=0;r<2;r++){var o=this.findContigousSpace(0==r?e:this.size-1-t,0==r?t:this.size-1-e,s);if(1==o[0]){this.row=o[1],this.col=o[2],this.writeWord();break i}}else this.row=i[1],this.col=i[2],this.writeWord()}return s.isPlaced},this.writeWord=function(){for(var i=s.chars,t=this.row,e=this.col,r=0;r<s.size;r++){var o=new Cell;o.value=i[r],this.cells[t++][e--]=o,s.containedIn(o),s.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var i=!1,t=0,e=this.word.chars,r=this.row,o=this.col,n=0;o>=0&&r<this.grid.size()&&(this.cells[r][o].isUnwritten()||this.cells[r][o]==e[n++]);){if(++t==s.size){i=!0;break}r++,o--}return i},this.findContigousSpace=function(i,t,s){for(var e=!1,r=0,o=s.chars,n=i,a=t;n>0&&a<this.size-1;)n--,a++;for(var l=0;a>=0&&n<this.grid.size();){if(this.cells[n][a].isUnwritten()||this.cells[n][a]==o[l++]){if(++r==s.size){e=!0;break}}else r=0;n++,a--}return e&&(n=n-s.size+1,a=a+s.size-1),[e,n,a]}}function Model(){this.grid=null,this.wordList=null,this.init=function(i,t){this.grid=i,this.wordList=t;for(var s=0;s<this.wordList.size();s++)i.put(Util.random(this.grid.size()),Util.random(this.grid.size()),this.wordList.get(s))}}function Word(i){this.value=i.toUpperCase(),this.originalValue=this.value,this.isFound=!1,this.cellsUsed=new Array,this.isPlaced=!1,this.row=-1,this.col=-1,this.size=-1,this.chars=null,this.init=function(){this.chars=this.value.split(""),this.size=this.chars.length},this.init(),this.containedIn=function(i){this.cellsUsed.push(i)},this.checkIfSimilar=function(i){return(this.originalValue==i||this.value==i)&&(this.isFound=!0,!0)}}function WordList(){this.words=new Array,this.loadWords=function(i){var t=this.words;$(i.split(",")).each(function(){t.push(new Word(this))})},this.add=function(i){if(10*Math.random()>5){for(var t="",s=i.size-1;s>=0;s--)t+=i.value.charAt(s);i.value=t,i.init()}this.words[this.words.length]=i},this.size=function(){return this.words.length},this.get=function(i){return this.words[i]},this.isWordPresent=function(i){for(var t=0;t<this.words.length;t++)if(this.words[t].checkIfSimilar(i))return t;return-1}}var Util={random:function(i){return Math.floor(Math.random()*i)},log:function(i){$("#logger").append(i)}},GameWidgetHelper={prepGrid:function(i,t){var s=new Grid;s.initializeGrid(i);var e=new WordList;e.loadWords(t);var r=new Model;return r.init(s,e),s.fillGrid(),r},renderGame:function(i,t){for(var s=t.grid,e=s.cells,r="<div id='rf-searchgamecontainer' class='rf-searchgamecontainer'><table id='rf-tablegrid' cellspacing=0 cellpadding=0 class='rf-tablestyle'>",o=0;o<s.size();o++){r+="<tr>";for(var n=0;n<s.size();n++)r+="<td  class='rf-tgrid'>"+e[o][n].value+"</td>";r+="</tr>"}r+="</table></div>",$(i).append(r);var a=0,l=0;$("tr","#rf-tablegrid").each(function(){$("td",this).each(function(i){var t=e[a][l++];$.data(this,"cell",t),t.td=this}),l=0,a++});var h="<div id='rf-wordcontainer' class='rf-wordcontainer'><ul>";$(t.wordList.words).each(function(){h+="<li class=rf-p"+this.isPlaced+">"+this.originalValue+"</li>"}),h+="</ul></div>",$(i).append(h)},signalWordFound:function(i){var t=$(".rf-wordcontainer li").get(i);jQuery(t).hasClass("rf-foundword")||(Visualizer.signalWordFound(t),currentWord++,"function"==typeof encontrePalabra&&encontrePalabra({id:i,word:$(t).text()}),"function"==typeof cuandoEncuentreTodas&&currentWord>=maxWords&&cuandoEncuentreTodas({}))}}}(jQuery);
