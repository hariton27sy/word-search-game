/*!
 * The Word Search Game Widget
 *
 * Copyright 2011, Ryan Fernandes (https://code.google.com/u/@VBFTRFJWDxFDXgJ4/)
 * Licensed under The MIT License.
 * see license.txt
 *
 */(function($,undefined){function Arms(){this.arms=null,this.deduceArm=function(a,b){this.returnToNormal();var c=$(a).parent().children().index(a);switch(this.arms=[],b){case 0:this.arms=$(a).prevAll();break;case 1:this.arms=$(a).nextAll();break;case 2:var d=this.arms;$(a).parent().prevAll().each(function(){d.push($(this).children().get(c))});break;case 3:var e=this.arms;$(a).parent().nextAll().each(function(){e.push($(this).children().get(c))});break;case 4:var f=this.arms,g=c;$(a).parent().prevAll().each(function(){f.push($(this).children().get(++g))});break;case 5:var h=this.arms,i=c;$(a).parent().prevAll().each(function(){h.push($(this).children().get(--i))});break;case 6:var j=this.arms,k=c;$(a).parent().nextAll().each(function(){j.push($(this).children().get(++k))});break;case 7:var l=this.arms,m=c;$(a).parent().nextAll().each(function(){l.push($(this).children().get(--m))});}for(var n=1;n<this.arms.length;n++)Visualizer.arm(this.arms[n])},this.glowTo=function(a){for(var b=$(this.arms).index(a),c=1;c<this.arms.length;c++)c<=b?Visualizer.glow(this.arms[c]):Visualizer.arm(this.arms[c])},this.returnToNormal=function(){if(this.arms)for(var a=1;a<this.arms.length;a++)Visualizer.restore(this.arms[a])},this.clean=function(){$(this.arms).each(function(){Visualizer.clean(this)})}}function Hotzone(){this.elems=null,this.createZone=function(a){this.elems=[];var b=$(a),c=b.parent().children().index(b),d=b.parent().prev().children().get(c),e=b.parent().next().children().get(c);this.elems.push(b.prev()[0],b.next()[0]),this.elems.push(d,e,$(d).next()[0],$(d).prev()[0],$(e).next()[0],$(e).prev()[0]),$(this.elems).each(function(){null!=$(this)&&Visualizer.arm(this)})},this.index=function(a){return $(this.elems).index(a)},this.setChosen=function(a){for(var b=0;b<this.elems.length;b++)Visualizer.arm(this.elems[b]);-1!=a&&Visualizer.glow(this.elems[a])},this.returnToNormal=function(){for(var a=0;a<this.elems.length;a++)Visualizer.restore(this.elems[a])},this.clean=function(){$(this.elems).each(function(){Visualizer.clean(this)})}}function Root(){this.root=null,this.setRoot=function(a){this.root=a,Visualizer.glow(this.root)},this.returnToNormal=function(){Visualizer.restore(this.root)},this.isSameCell=function(a){return $(this.root).is($(a))},this.clean=function(){Visualizer.clean(this.root)}}function Cell(){this.DEFAULT="-",this.isHighlighted=!1,this.value=this.DEFAULT,this.parentGrid=null,this.isUnwritten=function(){return this.value==this.DEFAULT},this.isSelected=!1,this.isSelecting=!0,this.td=null}function Grid(){this.cells=null,this.directions=["LeftDiagonal","Horizontal","Vertical"],this.initializeGrid=function(a){this.cells=Array(a);for(var b=0;b<a;b++){this.cells[b]=Array(a);for(var d,e=0;e<a;e++)d=new Cell,d.parentgrid=this,this.cells[b][e]=d}},this.getCell=function(a,b){return this.cells[a][b]},this.createHotZone=function(a){var b=a,c=b.parent().children().index(b)},this.size=function(){return this.cells.length},this.put=function(row,col,word){var populator=eval("new "+eval("this.directions["+Math.floor(Math.random()*this.directions.length)+"]")+"Populator(row,col,word, this)"),isPlaced=populator.populate();if(!isPlaced)for(var x=0;x<this.directions.length;x++){var populator2=eval("new "+eval("this.directions["+x+"]")+"Populator(row,col,word, this)"),isPlaced2=populator2.populate();if(isPlaced2)break}},this.fillGrid=function(){for(var a=0;a<this.size();a++)for(var b=0;b<this.size();b++)this.cells[a][b].isUnwritten()&&(this.cells[a][b].value=String.fromCharCode(Math.floor(1040+31*Math.random())))}}function HorizontalPopulator(a,b,d,e){this.grid=e,this.row=a,this.col=b,this.word=d,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else for(var a=0;a<this.size;a++){var b=(this.row+a)%this.size,c=this.findContigousSpace(b,d);if(-1==c){var e=this.isWordOverlapPossible(b,d);if(-1==e)continue;else{this.row=b,this.col=e,this.writeWord();break}}else{this.row=b,this.col=c,this.writeWord();break}}return d.isPlaced},this.writeWord=function(){for(var a,b=d.chars,e=0;e<d.size;e++)a=new Cell,a.value=b[e],this.cells[this.row][this.col+e]=a,d.containedIn(a),d.isPlaced=!0},this.isWordOverlapPossible=function(){return-1},this.willWordFit=function(){for(var c=!1,e=0,f=this.word.chars,g=b;g<this.size&&!!(this.cells[a][g].isUnwritten()||this.cells[a][g]==f[g]);g++)if(e++,e==d.size){c=!0;break}return c},this.findContigousSpace=function(a,b){for(var c=-1,d=0,e=b.chars,f=0;f<this.size;f++)if(!(this.cells[a][f].isUnwritten()||this.cells[a][f]==e[f]))d=0;else if(d++,d==b.size){c=f-(b.size-1);break}return c}}function VerticalPopulator(a,b,d,e){this.grid=e,this.row=a,this.col=b,this.word=d,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else for(var a=0;a<this.size;a++){var b=(this.col+a)%this.size,c=this.findContigousSpace(b,d);if(-1==c){var e=this.isWordOverlapPossible(b,d);if(-1==e)continue;else{this.row=e,this.col=b,this.writeWord();break}}else{this.row=c,this.col=b,this.writeWord();break}}return d.isPlaced},this.writeWord=function(){for(var a,b=d.chars,e=0;e<d.size;e++)a=new Cell,a.value=b[e],this.cells[this.row+e][this.col]=a,d.containedIn(a),d.isPlaced=!0},this.isWordOverlapPossible=function(){return-1},this.willWordFit=function(){for(var c=!1,e=0,f=this.word.chars,g=a;g<this.size&&!!(this.cells[g][b].isUnwritten()||f[g]==this.cells[g][b].value);g++)if(e++,e==d.size){c=!0;break}return c},this.findContigousSpace=function(a,b){for(var c=-1,d=0,e=b.chars,f=0;f<this.size;f++)if(!(this.cells[f][a].isUnwritten()||e[f]==this.cells[f][a].value))d=0;else if(d++,d==b.size){c=f-(b.size-1);break}return c}}function LeftDiagonalPopulator(a,b,d,e){this.grid=e,this.row=a,this.col=b,this.word=d,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else{var a=this.findContigousSpace(this.row,this.col,d);if(!0!=a[0]){OUTER:for(var b=0,c=this.size-d.size;0<=c;c--)for(var e,f=0;2>f;f++)if(e=this.findContigousSpace(0==f?c:b,0==f?b:c,d),!0==e[0]){this.row=e[1],this.col=e[2],this.writeWord();break OUTER}}else this.row=a[1],this.col=a[2],this.writeWord()}return d.isPlaced},this.writeWord=function(){for(var a,b=d.chars,e=this.row,f=this.col,g=0;g<d.size;g++)a=new Cell,a.value=b[g],this.cells[e++][f++]=a,d.containedIn(a),d.isPlaced=!0},this.isWordOverlapPossible=function(){return-1},this.willWordFit=function(){for(var a=!1,b=0,c=this.word.chars,e=this.row,f=this.col,g=0;f<this.grid.size()&&e<this.grid.size()&&!!(this.cells[e][f].isUnwritten()||this.cells[e][f]==c[g++]);){if(b++,b==d.size){a=!0;break}e++,f++}return a},this.findContigousSpace=function(a,b,c){for(var d=!1,e=0,f=c.chars,g=a,h=b;0<g&&0<h;)g--,h--;for(var j=0;;){if(!(this.cells[g][h].isUnwritten()||this.cells[g][h]==f[j++]))e=0;else if(e++,e==c.size){d=!0;break}if(h++,g++,h>=this.size||g>=this.size)break}return d&&(g=g-c.size+1,h=h-c.size+1),[d,g,h]}}function RightDiagonalPopulator(a,b,d,e){this.grid=e,this.row=a,this.col=b,this.word=d,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else{var a=this.findContigousSpace(this.row,this.col,d);if(!0!=a[0]){OUTER:for(var b=this.size-1,c=this.size-d.size;0<=c;c--)for(var e,f=0;2>f;f++)if(e=this.findContigousSpace(0==f?c:this.size-1-b,0==f?b:this.size-1-c,d),!0==e[0]){this.row=e[1],this.col=e[2],this.writeWord();break OUTER}}else this.row=a[1],this.col=a[2],this.writeWord()}return d.isPlaced},this.writeWord=function(){for(var a,b=d.chars,e=this.row,f=this.col,g=0;g<d.size;g++)a=new Cell,a.value=b[g],this.cells[e++][f--]=a,d.containedIn(a),d.isPlaced=!0},this.isWordOverlapPossible=function(){return-1},this.willWordFit=function(){for(var a=!1,b=0,c=this.word.chars,e=this.row,f=this.col,g=0;0<=f&&e<this.grid.size()&&!!(this.cells[e][f].isUnwritten()||this.cells[e][f]==c[g++]);){if(b++,b==d.size){a=!0;break}e++,f--}return a},this.findContigousSpace=function(a,b,c){for(var d=!1,e=0,f=c.chars,g=a,h=b;0<g&&h<this.size-1;)g--,h++;for(var j=0;0<=h&&g<this.grid.size();){if(!(this.cells[g][h].isUnwritten()||this.cells[g][h]==f[j++]))e=0;else if(e++,e==c.size){d=!0;break}g++,h--}return d&&(g=g-c.size+1,h=h+c.size-1),[d,g,h]}}function Model(){this.grid=null,this.wordList=null,this.init=function(a,b){this.grid=a,this.wordList=b;for(var c=0;c<this.wordList.size();c++)a.put(Util.random(this.grid.size()),Util.random(this.grid.size()),this.wordList.get(c))}}function Word(a){this.value=a.toUpperCase(),this.originalValue=this.value,this.isFound=!1,this.cellsUsed=[],this.isPlaced=!1,this.row=-1,this.col=-1,this.size=-1,this.chars=null,this.init=function(){this.chars=this.value.split(""),this.size=this.chars.length},this.init(),this.containedIn=function(a){this.cellsUsed.push(a)},this.checkIfSimilar=function(a){return!(this.originalValue!=a&&this.value!=a)&&(this.isFound=!0,!0)}}function WordList(){this.words=[],this.loadWords=function(a){var b=this.words;$(a.split(",")).each(function(){b.push(new Word(this))})},this.add=function(a){if(5<10*Math.random()){for(var b="",c=a.size-1;0<=c;c--)b+=a.value.charAt(c);a.value=b,a.init()}this.words[this.words.length]=a},this.size=function(){return this.words.length},this.get=function(a){return this.words[a]},this.isWordPresent=function(a){for(var b=0;b<this.words.length;b++)if(this.words[b].checkIfSimilar(a))return b;return-1}}var currentWord=0,maxWords=0,encontrePalabra=void 0,cuandoEncuentreTodas=void 0;$.widget("ryanf.wordsearchwidget",$.ui.mouse,{options:{wordlist:null,gridsize:10,onWordFound:void 0,onWordSearchComplete:void 0},_create:function(){this.model=GameWidgetHelper.prepGrid(this.options.gridsize,this.options.wordlist),this.startedAt=new Root,this.hotzone=new Hotzone,this.arms=new Arms,encontrePalabra=this.options.onWordFound,cuandoEncuentreTodas=this.options.onWordSearchComplete,maxWords=this.options.wordlist.split(",").length,GameWidgetHelper.renderGame(this.element[0],this.model),this.options.distance=0,this._mouseInit()},destroy:function(){return this.hotzone.clean(),this.arms.clean(),this.startedAt.clean(),this._mouseDestroy(),this},_mouseStart:function(a){var b=$(a.target).parents("div").attr("id");"rf-searchgamecontainer"==b?(this.startedAt.setRoot(a.target),this.hotzone.createZone(a.target)):"rf-wordcontainer"==b},_mouseDrag:function(a){if(this.startedAt.isSameCell(a.target))return this.arms.returnToNormal(),void this.hotzone.setChosen(-1);if($(a.target).hasClass("rf-armed")||$(a.target).hasClass("rf-glowing")){var b=this.hotzone.index(a.target);-1==b?this.arms.glowTo(a.target):(this.hotzone.setChosen(b),this.arms.deduceArm(this.startedAt.root,b))}},_mouseStop:function(){var a="";$(".rf-glowing, .rf-highlight",this.element[0]).each(function(){var b=$.data(this,"cell");a+=b.value});var b=this.model.wordList.isWordPresent(a);-1!=b&&($(".rf-glowing, .rf-highlight",this.element[0]).each(function(){Visualizer.select(this),$.data(this,"selected","true")}),GameWidgetHelper.signalWordFound(b));try{this.hotzone.returnToNormal(),this.startedAt.returnToNormal(),this.arms.returnToNormal()}catch(a){}}}),$.extend($.ryanf.wordsearchwidget,{version:"0.0.1"});var Visualizer={glow:function(a){$(a).removeClass("rf-armed").removeClass("rf-selected").addClass("rf-glowing")},arm:function(a){$(a).removeClass("rf-glowing").addClass("rf-armed")},restore:function(a){$(a).removeClass("rf-armed").removeClass("rf-glowing"),null!=a&&"true"==$.data(a,"selected")&&$(a).addClass("rf-selected")},select:function(a){$(a).removeClass("rf-armed").removeClass("rf-glowing").animate({opacity:"20"},500,"linear",function(){$(a).removeClass("rf-highlight").addClass("rf-selected").animate({opacity:"show"},500,"linear")})},highlight:function(a){$(a).removeClass("rf-armed").removeClass("rf-selected").addClass("rf-highlight")},signalWordFound:function(a){$(a).css("background","yellow").animate({opacity:"hide"},1e3,"linear",function(){$(a).css("background","white"),$(a).addClass("rf-foundword").animate({opacity:"show"},1e3,"linear")})},clean:function(a){$(a).removeClass("rf-armed").removeClass("rf-glowing").removeClass("rf-selected"),$.removeData($(a),"selected")}},Util={random:function(a){return Math.floor(Math.random()*a)},log:function(a){$("#logger").append(a)}},GameWidgetHelper={prepGrid:function(a,b){var c=new Grid;c.initializeGrid(a);var d=new WordList;d.loadWords(b);var e=new Model;return e.init(c,d),c.fillGrid(),e},renderGame:function(a,b){for(var c=b.grid,d=c.cells,e="<div id='rf-searchgamecontainer' class='rf-searchgamecontainer'><table id='rf-tablegrid' cellspacing=0 cellpadding=0 class='rf-tablestyle'>",f=0;f<c.size();f++){e+="<tr>";for(var g=0;g<c.size();g++)e+="<td  class='rf-tgrid'>"+d[f][g].value+"</td>";e+="</tr>"}e+="</table></div>",$(a).append(e);var h=0,k=0;$("tr","#rf-tablegrid").each(function(){$("td",this).each(function(){var a=d[h][k++];$.data(this,"cell",a),a.td=this}),k=0,h++});var l="<div id='rf-wordcontainer' class='rf-wordcontainer'><ul>";$(b.wordList.words).each(function(){l+="<li class=rf-p"+this.isPlaced+">"+this.originalValue+"</li>"}),l+="</ul></div>",$(a).append(l)},signalWordFound:function(a){var b=$("#theGrid li").get(a);jQuery(b).hasClass("rf-foundword")||(Visualizer.signalWordFound(b),currentWord++,"function"==typeof encontrePalabra&&encontrePalabra({id:a,word:$(b).text()}),"function"==typeof cuandoEncuentreTodas&&currentWord>=maxWords&&cuandoEncuentreTodas({}))}}})(jQuery);
