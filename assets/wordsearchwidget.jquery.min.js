/*!
 * The Word Search Game Widget
 *
 * Copyright 2011, Ryan Fernandes (https://code.google.com/u/@VBFTRFJWDxFDXgJ4/)
 * Licensed under The MIT License.
 * see license.txt
 *
 */
!function($,undefined){var currentWord=0,maxWords=0,encontrePalabra=undefined,cuandoEncuentreTodas=undefined;function Arms(){this.arms=null,this.deduceArm=function(i,t){this.returnToNormal();var e=$(i).parent().children().index(i);switch(this.arms=new Array,t){case 0:this.arms=$(i).prevAll();break;case 1:this.arms=$(i).nextAll();break;case 2:var s=this.arms;$(i).parent().prevAll().each(function(){s.push($(this).children().get(e))});break;case 3:var r=this.arms;$(i).parent().nextAll().each(function(){r.push($(this).children().get(e))});break;case 4:var n=this.arms,o=e;$(i).parent().prevAll().each(function(){n.push($(this).children().get(++o))});break;case 5:var a=this.arms,l=e;$(i).parent().prevAll().each(function(){a.push($(this).children().get(--l))});break;case 6:var h=this.arms,c=e;$(i).parent().nextAll().each(function(){h.push($(this).children().get(++c))});break;case 7:var d=this.arms,u=e;$(i).parent().nextAll().each(function(){d.push($(this).children().get(--u))})}for(var f=1;f<this.arms.length;f++)Visualizer.arm(this.arms[f])},this.glowTo=function(i){for(var t=$(this.arms).index(i),e=1;e<this.arms.length;e++)e<=t?Visualizer.glow(this.arms[e]):Visualizer.arm(this.arms[e])},this.returnToNormal=function(){if(this.arms)for(var i=1;i<this.arms.length;i++)Visualizer.restore(this.arms[i])},this.clean=function(){$(this.arms).each(function(){Visualizer.clean(this)})}}function Hotzone(){this.elems=null,this.createZone=function(i){this.elems=new Array;var t=$(i),e=t.parent().children().index(t),s=t.parent().prev().children().get(e),r=t.parent().next().children().get(e);this.elems.push(t.prev()[0],t.next()[0]),this.elems.push(s,r,$(s).next()[0],$(s).prev()[0],$(r).next()[0],$(r).prev()[0]),$(this.elems).each(function(){null!=$(this)&&Visualizer.arm(this)})},this.index=function(i){return $(this.elems).index(i)},this.setChosen=function(i){for(var t=0;t<this.elems.length;t++)Visualizer.arm(this.elems[t]);-1!=i&&Visualizer.glow(this.elems[i])},this.returnToNormal=function(){for(var i=0;i<this.elems.length;i++)Visualizer.restore(this.elems[i])},this.clean=function(){$(this.elems).each(function(){Visualizer.clean(this)})}}function Root(){this.root=null,this.setRoot=function(i){this.root=i,Visualizer.glow(this.root)},this.returnToNormal=function(){Visualizer.restore(this.root)},this.isSameCell=function(i){return $(this.root).is($(i))},this.clean=function(){Visualizer.clean(this.root)}}$.widget("ryanf.wordsearchwidget",$.ui.mouse,{options:{wordlist:null,gridsize:10,onWordFound:undefined,onWordSearchComplete:undefined},_mapEventToCell:function(i){var t=Math.ceil((i.pageX-this._cellX)/this._cellWidth),e=Math.ceil((i.pageY-this._cellY)/this._cellHeight);return $("#rf-tablegrid tr:nth-child("+e+") td:nth-child("+t+")")},_create:function(){this.model=GameWidgetHelper.prepGrid(this.options.gridsize,this.options.wordlist),this.startedAt=new Root,this.hotzone=new Hotzone,this.arms=new Arms,encontrePalabra=this.options.onWordFound,cuandoEncuentreTodas=this.options.onWordSearchComplete,maxWords=this.options.wordlist.split(",").length,GameWidgetHelper.renderGame(this.element[0],this.model),this.options.distance=0,this._mouseInit();var i=$("#rf-tablegrid tr:first td:first");this._cellWidth=i.outerWidth(),this._cellHeight=i.outerHeight(),this._cellX=i.offset().left,this._cellY=i.offset().top},destroy:function(){return this.hotzone.clean(),this.arms.clean(),this.startedAt.clean(),this._mouseDestroy(),this},_mouseStart:function(i){var t=$(i.target).parents("div").attr("id");if("rf-searchgamecontainer"==t)this.startedAt.setRoot(i.target),this.hotzone.createZone(i.target);else if("rf-wordcontainer"==t){var e=$(i.target).parent().children().index(i.target),s=this.model.wordList.get(e);$(s.cellsUsed).each(function(){Visualizer.highlight($(this.td))})}},_mouseDrag:function(i){if(i.target=this._mapEventToCell(i),this.startedAt.isSameCell(i.target))return this.arms.returnToNormal(),void this.hotzone.setChosen(-1);if($(i.target).hasClass("rf-armed")||$(i.target).hasClass("rf-glowing")){var t=this.hotzone.index(i.target);-1!=t?(this.hotzone.setChosen(t),this.arms.deduceArm(this.startedAt.root,t)):this.arms.glowTo(i.target)}},_mouseStop:function(i){var t="";$(".rf-glowing, .rf-highlight",this.element[0]).each(function(){var i=$.data(this,"cell");t+=i.value});var e=this.model.wordList.isWordPresent(t);-1!=e&&($(".rf-glowing, .rf-highlight",this.element[0]).each(function(){Visualizer.select(this),$.data(this,"selected","true")}),GameWidgetHelper.signalWordFound(e));try{this.hotzone.returnToNormal(),this.startedAt.returnToNormal(),this.arms.returnToNormal()}catch(i){}}}),$.extend($.ryanf.wordsearchwidget,{version:"0.0.1"});var Visualizer={glow:function(i){$(i).removeClass("rf-armed").removeClass("rf-selected").addClass("rf-glowing")},arm:function(i){$(i).removeClass("rf-glowing").addClass("rf-armed")},restore:function(i){$(i).removeClass("rf-armed").removeClass("rf-glowing"),null!=i&&"true"==$.data(i,"selected")&&$(i).addClass("rf-selected")},select:function(i){$(i).removeClass("rf-armed").removeClass("rf-glowing").animate({opacity:"20"},500,"linear",function(){$(i).removeClass("rf-highlight").addClass("rf-selected").animate({opacity:"show"},500,"linear")})},highlight:function(i){$(i).removeClass("rf-armed").removeClass("rf-selected").addClass("rf-highlight")},signalWordFound:function(i){$(i).css("background","yellow").animate({opacity:"hide"},1e3,"linear",function(){$(i).css("background","white"),$(i).addClass("rf-foundword").animate({opacity:"show"},1e3,"linear")})},clean:function(i){$(i).removeClass("rf-armed").removeClass("rf-glowing").removeClass("rf-selected"),$.removeData($(i),"selected")}};function Cell(){this.DEFAULT="-",this.isHighlighted=!1,this.value=this.DEFAULT,this.parentGrid=null,this.isUnwritten=function(){return this.value==this.DEFAULT},this.isSelected=!1,this.isSelecting=!0,this.td=null}function Grid(){this.cells=null,this.directions=["LeftDiagonal","Horizontal","Vertical"],this.initializeGrid=function(i){this.cells=new Array(i);for(var t=0;t<i;t++){this.cells[t]=new Array(i);for(var e=0;e<i;e++){var s=new Cell;s.parentgrid=this,this.cells[t][e]=s}}},this.getCell=function(i,t){return this.cells[i][t]},this.createHotZone=function(i){var t=i;new Array,t.parent().children().index(t)},this.size=function(){return this.cells.length},this.put=function(row,col,word){var populator=eval("new "+eval("this.directions["+Math.floor(Math.random()*this.directions.length)+"]")+"Populator(row,col,word, this)"),isPlaced=populator.populate();if(!isPlaced)for(var x=0;x<this.directions.length;x++){var populator2=eval("new "+eval("this.directions["+x+"]")+"Populator(row,col,word, this)"),isPlaced2=populator2.populate();if(isPlaced2)break}},this.fillGrid=function(){for(var i=0;i<this.size();i++)for(var t=0;t<this.size();t++)this.cells[i][t].isUnwritten()&&(this.cells[i][t].value=String.fromCharCode(Math.floor("А".charCodeAt()+31*Math.random())))}}function HorizontalPopulator(i,t,e,s){this.grid=s,this.row=i,this.col=t,this.word=e,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else for(var i=0;i<this.size;i++){var t=(this.row+i)%this.size,s=this.findContigousSpace(t,e);if(-1==s){var r=this.isWordOverlapPossible(t,e);if(-1==r)continue;this.row=t,this.col=r,this.writeWord();break}this.row=t,this.col=s,this.writeWord();break}return e.isPlaced},this.writeWord=function(){for(var i=e.chars,t=0;t<e.size;t++){var s=new Cell;s.value=i[t],this.cells[this.row][this.col+t]=s,e.containedIn(s),e.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var s=!1,r=0,n=this.word.chars,o=t;o<this.size&&(this.cells[i][o].isUnwritten()||this.cells[i][o]==n[o]);o++)if(++r==e.size){s=!0;break}return s},this.findContigousSpace=function(i,t){for(var e=-1,s=0,r=t.chars,n=0;n<this.size;n++)if(this.cells[i][n].isUnwritten()||this.cells[i][n]==r[n]){if(++s==t.size){e=n-(t.size-1);break}}else s=0;return e}}function VerticalPopulator(i,t,e,s){this.grid=s,this.row=i,this.col=t,this.word=e,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else for(var i=0;i<this.size;i++){var t=(this.col+i)%this.size,s=this.findContigousSpace(t,e);if(-1==s){var r=this.isWordOverlapPossible(t,e);if(-1==r)continue;this.row=r,this.col=t,this.writeWord();break}this.row=s,this.col=t,this.writeWord();break}return e.isPlaced},this.writeWord=function(){for(var i=e.chars,t=0;t<e.size;t++){var s=new Cell;s.value=i[t],this.cells[this.row+t][this.col]=s,e.containedIn(s),e.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var s=!1,r=0,n=this.word.chars,o=i;o<this.size&&(this.cells[o][t].isUnwritten()||n[o]==this.cells[o][t].value);o++)if(++r==e.size){s=!0;break}return s},this.findContigousSpace=function(i,t){for(var e=-1,s=0,r=t.chars,n=0;n<this.size;n++)if(this.cells[n][i].isUnwritten()||r[n]==this.cells[n][i].value){if(++s==t.size){e=n-(t.size-1);break}}else s=0;return e}}function LeftDiagonalPopulator(i,t,e,s){this.grid=s,this.row=i,this.col=t,this.word=e,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else{var i=this.findContigousSpace(this.row,this.col,e);if(1!=i[0])i:for(var t=this.size-e.size;t>=0;t--)for(var s=0;s<2;s++){var r=this.findContigousSpace(0==s?t:0,0==s?0:t,e);if(1==r[0]){this.row=r[1],this.col=r[2],this.writeWord();break i}}else this.row=i[1],this.col=i[2],this.writeWord()}return e.isPlaced},this.writeWord=function(){for(var i=e.chars,t=this.row,s=this.col,r=0;r<e.size;r++){var n=new Cell;n.value=i[r],this.cells[t++][s++]=n,e.containedIn(n),e.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var i=!1,t=0,s=this.word.chars,r=this.row,n=this.col,o=0;n<this.grid.size()&&r<this.grid.size()&&(this.cells[r][n].isUnwritten()||this.cells[r][n]==s[o++]);){if(++t==e.size){i=!0;break}r++,n++}return i},this.findContigousSpace=function(i,t,e){for(var s=!1,r=0,n=e.chars,o=i,a=t;o>0&&a>0;)o--,a--;for(var l=0;;){if(this.cells[o][a].isUnwritten()||this.cells[o][a]==n[l++]){if(++r==e.size){s=!0;break}}else r=0;if(o++,++a>=this.size||o>=this.size)break}return s&&(o=o-e.size+1,a=a-e.size+1),[s,o,a]}}function RightDiagonalPopulator(i,t,e,s){this.grid=s,this.row=i,this.col=t,this.word=e,this.size=this.grid.size(),this.cells=this.grid.cells,this.populate=function(){if(this.willWordFit())this.writeWord();else{var i=this.findContigousSpace(this.row,this.col,e);if(1!=i[0])i:for(var t=this.size-1,s=this.size-e.size;s>=0;s--)for(var r=0;r<2;r++){var n=this.findContigousSpace(0==r?s:this.size-1-t,0==r?t:this.size-1-s,e);if(1==n[0]){this.row=n[1],this.col=n[2],this.writeWord();break i}}else this.row=i[1],this.col=i[2],this.writeWord()}return e.isPlaced},this.writeWord=function(){for(var i=e.chars,t=this.row,s=this.col,r=0;r<e.size;r++){var n=new Cell;n.value=i[r],this.cells[t++][s--]=n,e.containedIn(n),e.isPlaced=!0}},this.isWordOverlapPossible=function(i,t){return-1},this.willWordFit=function(){for(var i=!1,t=0,s=this.word.chars,r=this.row,n=this.col,o=0;n>=0&&r<this.grid.size()&&(this.cells[r][n].isUnwritten()||this.cells[r][n]==s[o++]);){if(++t==e.size){i=!0;break}r++,n--}return i},this.findContigousSpace=function(i,t,e){for(var s=!1,r=0,n=e.chars,o=i,a=t;o>0&&a<this.size-1;)o--,a++;for(var l=0;a>=0&&o<this.grid.size();){if(this.cells[o][a].isUnwritten()||this.cells[o][a]==n[l++]){if(++r==e.size){s=!0;break}}else r=0;o++,a--}return s&&(o=o-e.size+1,a=a+e.size-1),[s,o,a]}}function Model(){this.grid=null,this.wordList=null,this.init=function(i,t){this.grid=i,this.wordList=t;for(var e=0;e<this.wordList.size();e++)i.put(Util.random(this.grid.size()),Util.random(this.grid.size()),this.wordList.get(e))}}function Word(i){this.value=i.toUpperCase(),this.originalValue=this.value,this.isFound=!1,this.cellsUsed=new Array,this.isPlaced=!1,this.row=-1,this.col=-1,this.size=-1,this.chars=null,this.init=function(){this.chars=this.value.split(""),this.size=this.chars.length},this.init(),this.containedIn=function(i){this.cellsUsed.push(i)},this.checkIfSimilar=function(i){return(this.originalValue==i||this.value==i)&&(this.isFound=!0,!0)}}function WordList(){this.words=new Array,this.loadWords=function(i){var t=this.words;$(i.split(",")).each(function(){t.push(new Word(this))})},this.add=function(i){if(10*Math.random()>5){for(var t="",e=i.size-1;e>=0;e--)t+=i.value.charAt(e);i.value=t,i.init()}this.words[this.words.length]=i},this.size=function(){return this.words.length},this.get=function(i){return this.words[i]},this.isWordPresent=function(i){for(var t=0;t<this.words.length;t++)if(this.words[t].checkIfSimilar(i))return t;return-1}}var Util={random:function(i){return Math.floor(Math.random()*i)},log:function(i){$("#logger").append(i)}},GameWidgetHelper={prepGrid:function(i,t){var e=new Grid;e.initializeGrid(i);var s=new WordList;s.loadWords(t);var r=new Model;return r.init(e,s),e.fillGrid(),r},renderGame:function(i,t){for(var e=t.grid,s=e.cells,r="<div id='rf-searchgamecontainer' class='rf-searchgamecontainer'><table id='rf-tablegrid' cellspacing=0 cellpadding=0 class='rf-tablestyle'>",n=0;n<e.size();n++){r+="<tr>";for(var o=0;o<e.size();o++)r+="<td  class='rf-tgrid'>"+s[n][o].value+"</td>";r+="</tr>"}r+="</table></div>",$(i).append(r);var a=0,l=0;$("tr","#rf-tablegrid").each(function(){$("td",this).each(function(i){var t=s[a][l++];$.data(this,"cell",t),t.td=this}),l=0,a++});var h="<div id='rf-wordcontainer' class='rf-wordcontainer'><ul>";$(t.wordList.words).each(function(){h+="<li class=rf-p"+this.isPlaced+">"+this.originalValue+"</li>"}),h+="</ul></div>",$(i).append(h)},signalWordFound:function(i){var t=$("#theGrid li").get(i);jQuery(t).hasClass("rf-foundword")||(Visualizer.signalWordFound(t),currentWord++,"function"==typeof encontrePalabra&&encontrePalabra({id:i,word:$(t).text()}),"function"==typeof cuandoEncuentreTodas&&currentWord>=maxWords&&cuandoEncuentreTodas({}))}}}(jQuery);
